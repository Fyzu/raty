"use strict";function ownKeys(e,t){var s,i=Object.keys(e);return Object.getOwnPropertySymbols&&(s=Object.getOwnPropertySymbols(e),t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)),i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(s),!0).forEach(function(t){_defineProperty(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Raty=function(){function s(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,s),this.element=t,this.opt=_objectSpread(_objectSpread({},this.defaultOptions()),e),this.self=document.querySelector(t)}return _createClass(s,[{key:"defaultOptions",value:function(){return{cancelButton:!1,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,iconRangeSame:!1,mouseout:void 0,mouseover:void 0,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:void 0,precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:void 0,scoreName:"score",single:!1,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:void 0,targetFormat:"{score}",targetKeep:!1,targetScore:void 0,targetText:"",targetType:"hint"}}},{key:"cancel",value:function(t){this._parseBoolean(this.self.dataset.readOnly)||(this[t?"click":"score"].call(this,null),this.scoreField.removeAttribute("value"))}},{key:"click",value:function(t){this._parseBoolean(this.self.dataset.readOnly)||(t=this._adjustedScore(t),this._apply(t),this.opt.click&&this.opt.click.call(this.self,t,new Event("click")),this._target(t))}},{key:"move",value:function(t){var e=parseInt(t,10),t=this._getDecimal(t,1),s=(e>=this.opt.number&&(e=this.opt.number-1,t=10),this._getWidth()),e=this.stars[e],s=e.offsetLeft+s/10*t,t=new Event("mousemove");t.pageX=s,this.isMove=!0,e.dispatchEvent(t),this.isMove=!1}},{key:"readOnly",value:function(t){this._parseBoolean(this.self.dataset.readOnly)!==t&&(t?this._lock():(this._binds(),this._unlock()),this.self.dataset.readOnly=t)}},{key:"score",value:function(){return arguments.length?this.setScore.apply(this,arguments):this.getScore()}},{key:"setScore",value:function(t){this._parseBoolean(this.self.dataset.readOnly)||(t=this._adjustedScore(t),this._apply(t),this._target(t))}},{key:"getScore",value:function(){var t=[],e=this.scoreField.value;return t.push(e?+e:void 0),1<t.length?t:t[0]}},{key:"init",value:function(){return this._executeCallbacks(),this._adjustNumber(),this._adjustHints(),this.opt.score=this._adjustedScore(this.opt.score),"img"!==this.opt.starType&&this._adjustStarName(),this._setPath(),this._createStars(),this.opt.cancelButton&&this._createCancel(),this.opt.precision&&this._adjustPrecision(),this._createScore(),this._apply(this.opt.score),this._setTitle(this.opt.score),this._target(this.opt.score),this.opt.readOnly?this._lock():(this.self.style.cursor="pointer",this._binds()),this}},{key:"_parseBoolean",value:function(t){if("string"==typeof t){t=t.toLowerCase().trim();try{return JSON.parse(t)}catch(t){}}}},{key:"_adjustedScore",value:function(t){if(t||0===t)return this._between(t,0,this.opt.number)}},{key:"_adjustHints",value:function(){if(this.opt.hints||(this.opt.hints=[]),this.opt.halfShow||this.opt.half)for(var t=this.opt.precision?10:2,e=0;e<this.opt.number;e++){var s=this.opt.hints[e];"[object Array]"!==Object.prototype.toString.call(s)&&(s=[s]),this.opt.hints[e]=[];for(var i=0;i<t;i++){var n=s[i],a=s[s.length-1];void 0===a&&(a=null),this.opt.hints[e][i]=void 0===n?a:n}}}},{key:"_adjustNumber",value:function(){this.opt.number=this._between(this.opt.number,1,this.opt.numberMax)}},{key:"_adjustPrecision",value:function(){this.opt.half=!0}},{key:"_adjustStarName",value:function(){var t=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var e=0;e<t.length;e++)this.opt[t[e]]=this.opt[t[e]].replace(".","-")}},{key:"_apply",value:function(t){this._fill(t),t&&(0<t&&(this.scoreField.value=t),this._roundStars(t))}},{key:"_attributesForIndex",value:function(t){var e=this._nameForIndex(t),s={alt:t,src:this.opt.path+this.opt[e]};return(s="img"!==this.opt.starType?{"data-alt":t,class:this.opt[e]}:s).title=this._getHint(t),s}},{key:"_between",value:function(t,e,s){return Math.min(Math.max(parseFloat(t),e),s)}},{key:"_binds",value:function(){this.cancelButton&&(this._bindOverCancel(),this._bindClickCancel(),this._bindOutCancel()),this._bindOver(),this._bindClick(),this._bindOut()}},{key:"_bindClick",value:function(){var n=this;this.stars.forEach(function(i){i.addEventListener("click",function(t){var e,s;n._parseBoolean(n.self.dataset.readOnly)||(e=!0,s=n.opt.half||n.opt.precision?n.self.dataset.score:i.alt||i.dataset.alt,n.opt.half&&!n.opt.precision&&(s=n._roundHalfScore(s)),!(e=n.opt.click?n.opt.click.call(n.self,+s,t):e)&&void 0!==e||n._apply(+s))})})}},{key:"_bindClickCancel",value:function(){this.cancelButton.addEventListener("click",function(t){this.scoreField.removeAttribute("value"),this.opt.click&&this.opt.click.call(this.self,null,t)}.bind(this))}},{key:"_bindOut",value:function(){this.self.addEventListener("mouseleave",function(t){var e=+this.scoreField.value||void 0;this._apply(e),this._target(e,t),this._resetTitle(),this.opt.mouseout&&this.opt.mouseout.call(this.self,e,t)}.bind(this))}},{key:"_bindOutCancel",value:function(){var s=this;this.cancelButton.addEventListener("mouseleave",function(t){var e=s.opt.cancelOff;"img"!==s.opt.starType&&(e=s.opt.cancelClass+" "+e),s._setIcon(s.cancelButton,e),s.opt.mouseout&&(e=+s.scoreField.value||void 0,s.opt.mouseout.call(s.self,e,t))})}},{key:"_bindOver",value:function(){var i=this,t=i.opt.half?"mousemove":"mouseover";this.stars.forEach(function(s){s.addEventListener(t,function(t){var e=i._getScoreByPosition(t,s);i._fill(e),i.opt.half&&(i._roundStars(e,t),i._setTitle(e,t),i.self.dataset.score=e),i._target(e,t),i.opt.mouseover&&i.opt.mouseover.call(i.self,e,t)})})}},{key:"_bindOverCancel",value:function(){var i=this;this.cancelButton.addEventListener("mouseover",function(t){var e,s;i._parseBoolean(i.self.dataset.readOnly)||(e=i.opt.path+i.opt.starOff,s=i.opt.cancelOn,"img"===i.opt.starType?i.stars.forEach(function(t){t.src=e}):(s=i.opt.cancelClass+" "+s,i.stars.forEach(function(t){t.className=e})),i._setIcon(i.cancelButton,s),i._target(null,t),i.opt.mouseover&&i.opt.mouseover.call(i.self,null))})}},{key:"_buildScoreField",value:function(){var t=document.createElement("input");return t.name=this.opt.scoreName,t.type="hidden",this.self.appendChild(t),t}},{key:"_createCancel",value:function(){var t,e=this.opt.path+this.opt.cancelOff,s=document.createElement(this.opt.starType),i={title:this.opt.cancelHint,class:this.opt.cancelClass};for(t in"img"===this.opt.starType?(i.src=e,i.alt="x"):(i["data-alt"]="x",i.class=e),i)s.setAttribute(t,i[t]);"left"===this.opt.cancelPlace?(this.self.prepend(" "),this.self.prepend(s)):(this.self.append(" "),this.self.appendChild(s)),this.cancelButton=s}},{key:"_createScore",value:function(){var t=document.querySelector(this.opt.targetScore);this.scoreField=t||this._buildScoreField()}},{key:"_createStars",value:function(){for(var t=1;t<=this.opt.number;t++){var e,s=this._attributesForIndex(t),i=document.createElement(this.opt.starType);for(e in s)i.setAttribute(e,s[e]);this.self.appendChild(i),this.opt.space&&t<this.opt.number&&this.self.append(" ")}var n=document.querySelectorAll("".concat(this.element," > ").concat(this.opt.starType));this.stars=n}},{key:"_error",value:function(t){throw new Error(t)}},{key:"_executeCallbacks",value:function(){for(var t,e=["number","readOnly","score","scoreName","target","path"],s=0;s<e.length;s++)"function"==typeof this.opt[e[s]]&&((t=this.opt[e[s]].call(this.element))?this.opt[e[s]]=t:delete this.opt[e[s]])}},{key:"_fill",value:function(t){var e=0;if(this.opt.iconRangeSame&&this.opt.iconRange)for(;e<this.opt.iconRange.length&&this.opt.iconRange[e].range<t;)e++;for(var s=1;s<=this.stars.length;s++){var i,n,a=this.stars[s-1],o=this._turnOn(s,t);this.opt.iconRange&&this.opt.iconRange.length>e?(i=this.opt.iconRange[e],n=this._getRangeIcon(i,o),s<=i.range&&this._setIcon(a,n),s===i.range&&e++):(n=this.opt[o?"starOn":"starOff"],this._setIcon(a,n))}}},{key:"_getDecimal",value:function(t,e){var t=t.toString().split(".")[1],s=0;return t&&(s=parseInt(t.slice(0,e),10),"9999"===t.slice(1,5)&&s++),s}},{key:"_getRangeIcon",value:function(t,e){return e?t.on||this.opt.starOn:t.off||this.opt.starOff}},{key:"_getScoreByPosition",value:function(t,e){var s,i=parseInt(e.alt||e.getAttribute("data-alt"),10);return this.opt.half&&(s=this._getWidth(),i=i-1+parseFloat((t.pageX-e.offsetLeft)/s)),i}},{key:"_getHint",value:function(t,e){var s,i,n;return 0===t||t?(s=this._getDecimal(t,1),i=Math.ceil(t),n=i=this.opt.hints[(i||1)-1],e=!e||this.isMove,this.opt.precision?n=i[s=e?0===s?9:s-1:s]:(this.opt.halfShow||this.opt.half)&&(n=i[s=e&&0===s||5<s?1:0]),""===n?"":n||t):this.opt.noRatedMsg}},{key:"_getWidth",value:function(){var t=parseFloat(this.stars[0].offsetWidth);return t||this._error("Could not get the icon width!"),t}},{key:"_lock",value:function(){var e=this._getHint(this.scoreField.value);this.self.style.pointerEvents="none",this.self.title=e,this.scoreField.readOnly=!0,this.stars.forEach(function(t){t.title=e}),this.cancelButton&&(this.cancelButton.style.display="none"),this.self.dataset.readOnly=!0}},{key:"_nameForIndex",value:function(t){return this.opt.score&&this.opt.score>=t?"starOn":"starOff"}},{key:"_resetTitle",value:function(){for(var t=0;t<this.opt.number;t++)this.stars[t].title=this._getHint(t+1)}},{key:"_roundHalfScore",value:function(t){var e=parseInt(t,10),t=this._getDecimal(t,1);return e+(t=0!==t?5<t?1:.5:t)}},{key:"_roundStars",value:function(t,e){var e=this._starName(t,e);e&&(e=this.opt[e],t=this.stars[Math.ceil(t)-1],this._setIcon(t,e))}},{key:"_setIcon",value:function(t,e){t["img"===this.opt.starType?"src":"className"]=this.opt.path+e}},{key:"_setPath",value:function(){this.opt.path=this.opt.path||"",this.opt.path&&"/"!==this.opt.path.slice(-1)[0]&&(this.opt.path+="/")}},{key:"_setTarget",value:function(t,e){e=e&&this.opt.targetFormat.toString().replace("{score}",e),t instanceof HTMLInputElement||t instanceof HTMLSelectElement?t.value=e:t.textContent=e}},{key:"_setTitle",value:function(t,e){var s;t&&(s=parseInt(Math.ceil(t),10),this.stars[s-1].title=this._getHint(t,e))}},{key:"_starName",value:function(t,e){t=+(t%1).toFixed(2);return e||this.isMove?.5<t?"starOn":"starHalf":t<=this.opt.round.down?void 0:this.opt.halfShow&&t<this.opt.round.up?"starHalf":t<this.opt.round.full?"starOff":"starOn"}},{key:"_target",value:function(t,e){var s,i;this.opt.target&&((s=document.querySelector(this.opt.target))||this._error("Target selector invalid or missing!"),i=e&&"mouseover"===e.type,void 0===t?t=this.opt.targetText:null===t?t=i?this.opt.cancelHint:this.opt.targetText:("hint"===this.opt.targetType?t=this._getHint(t,e):this.opt.precision&&(t=parseFloat(t).toFixed(1)),e=e&&"mousemove"===e.type,i||e||this.opt.targetKeep||(t=this.opt.targetText)),this._setTarget(s,t))}},{key:"_turnOn",value:function(t,e){return this.opt.single?t===e:t<=e}},{key:"_unlock",value:function(){this.self.style.pointerEvents="auto",this.self.removeAttribute("title"),this.scoreField.readOnly=!1,this.self.dataset.readOnly=!1,this._resetTitle(),this.cancelButton&&(this.cancelButton.style.display="")}}]),s}(),_default=Raty;exports.default=_default;