"use strict";function ownKeys(e,t){var i,s=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)),s}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var defaultoptions=Object.seal({cancelButton:!1,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,iconRangeSame:!1,mouseout:void 0,mouseover:void 0,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:void 0,precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:void 0,scoreName:"score",single:!1,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:void 0,targetFormat:"{score}",targetKeep:!1,targetScore:void 0,targetText:"",targetType:"hint",initialize:!0}),Raty=function(){function i(t,e){if(_classCallCheck(this,i),e){if("object"!==_typeof(e)||Array.isArray(e))throw new Error("Illegal parameter");this.opt=_objectSpread(_objectSpread({},defaultoptions),e)}else this.opt=defaultoptions;this.self=document.querySelector(t),this.element=t,this.opt.initialize&&this.init()}return _createClass(i,[{key:"cancel",value:function(t){this.opt.readOnly||(this[t?"click":"score"].call(this,null),this.scoreField.removeAttribute("value"))}},{key:"click",value:function(t){this.opt.readOnly||(t=this._adjustedScore(t),this._apply(t),this.opt.click&&this.opt.click.call(this.self,t,new Event("click")),this._target(t))}},{key:"move",value:function(t){var e=parseInt(t,10),t=this._getDecimal(t,1),i=(e>=this.opt.number&&(e=this.opt.number-1,t=10),this._getWidth()),e=this.stars[e],i=e.offsetLeft+i/10*t,t=new Event("mousemove");t.pageX=i,this.isMove=!0,e.dispatchEvent(t),this.isMove=!1}},{key:"readOnly",value:function(t){this.opt.readOnly!==t&&(t?this._lock():(this._binds(),this._unlock()),this.self.readOnly=this.readOnly)}},{key:"score",value:function(){return arguments.length?this.setScore.apply(this,arguments):this.getScore()}},{key:"setScore",value:function(t){this.opt.readOnly||(t=this._adjustedScore(t),this._apply(t),this._target(t))}},{key:"getScore",value:function(){var t=[],e=this.scoreField.value;return t.push(e?+e:void 0),1<t.length?t:t[0]}},{key:"init",value:function(){this._executeCallbacks(),this._adjustNumber(),this._adjustHints(),this.opt.score=this._adjustedScore(this.opt.score),"img"!==this.opt.starType&&this._adjustStarName(),this._setPath(),this._createStars(),this.opt.cancelButton&&this._createCancel(),this.opt.precision&&this._adjustPrecision(),this._createScore(),this._apply(this.opt.score),this._setTitle(this.opt.score),this._target(this.opt.score),this.opt.readOnly?this._lock():(this.self.style.cursor="pointer",this._binds())}},{key:"_adjustedScore",value:function(t){if(t||0===t)return this._between(t,0,this.opt.number)}},{key:"_adjustHints",value:function(){if(this.opt.hints||(this.opt.hints=[]),this.opt.halfShow||this.opt.half)for(var t=this.opt.precision?10:2,e=0;e<this.opt.number;e++){var i=this.opt.hints[e];"[object Array]"!==Object.prototype.toString.call(i)&&(i=[i]),this.opt.hints[e]=[];for(var s=0;s<t;s++){var o=i[s],n=i[i.length-1];void 0===n&&(n=null),this.opt.hints[e][s]=void 0===o?n:o}}}},{key:"_adjustNumber",value:function(){this.opt.number=this._between(this.opt.number,1,this.opt.numberMax)}},{key:"_adjustPrecision",value:function(){this.opt.half=!0}},{key:"_adjustStarName",value:function(){var t=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var e=0;e<t.length;e++)this.opt[t[e]]=this.opt[t[e]].replace(".","-")}},{key:"_apply",value:function(t){this._fill(t),t&&(0<t&&(this.scoreField.value=t),this._roundStars(t))}},{key:"_attributesForIndex",value:function(t){var e=this._nameForIndex(t),i={alt:t,src:this.opt.path+this.opt[e]};return(i="img"!==this.opt.starType?{"data-alt":t,class:this.opt[e]}:i).title=this._getHint(t),i}},{key:"_between",value:function(t,e,i){return Math.min(Math.max(parseFloat(t),e),i)}},{key:"_binds",value:function(){this.cancelButton&&(this._bindOverCancel(),this._bindClickCancel(),this._bindOutCancel()),this._bindOver(),this._bindClick(),this._bindOut()}},{key:"_bindClick",value:function(){var o=this;this.stars.forEach(function(s){s.addEventListener("click",function(t){var e,i;o.opt.readOnly||(e=!0,i=o.opt.half||o.opt.precision?o.opt.score:s.alt,o.opt.half&&!o.opt.precision&&(i=o._roundHalfScore(i)),!(e=o.opt.click?o.opt.click.call(o.self,+i,t):e)&&void 0!==e||o._apply(+i))})})}},{key:"_bindClickCancel",value:function(){this.cancelButton.addEventListener("click",function(t){this.scoreField.removeAttribute("value"),this.opt.click&&this.opt.click.call(this.self,null,t)}.bind(this))}},{key:"_bindOut",value:function(){this.self.addEventListener("mouseleave",function(t){var e=+this.scoreField.value||void 0;this._apply(e),this._target(e,t),this._resetTitle(),this.opt.mouseout&&this.opt.mouseout.call(this.self,e,t)}.bind(this))}},{key:"_bindOutCancel",value:function(){var i=this;this.cancelButton.addEventListener("mouseleave",function(t){var e=i.opt.cancelOff;"img"!==i.opt.starType&&(e=i.opt.cancelClass+" "+e),i._setIcon(this,e),i.opt.mouseout&&(e=+i.scoreField.value||void 0,i.opt.mouseout.call(i.self,e,t))})}},{key:"_bindOver",value:function(){var s=this,t=s.opt.half?"mousemove":"mouseover";this.stars.forEach(function(i){i.addEventListener(t,function(t){var e=s._getScoreByPosition(t,i);s._fill(e),s.opt.half&&(s._roundStars(e,t),s._setTitle(e,t),s.opt.score=e),s._target(e,t),s.opt.mouseover&&s.opt.mouseover.call(s.self,e,t)})})}},{key:"_bindOverCancel",value:function(){var s=this;this.cancelButton.addEventListener("mouseover",function(t){var e,i;s.opt.readOnly||(e=s.opt.path+s.opt.starOff,i=s.opt.cancelOn,"img"===s.opt.starType?s.stars.forEach(function(t){t.src=e}):(i=s.opt.cancelClass+" "+i,s.stars.forEach(function(t){t.className=e})),s._setIcon(this,i),s._target(null,t),s.opt.mouseover&&s.opt.mouseover.call(s.self,null))})}},{key:"_buildScoreField",value:function(){var t=document.createElement("input");return t.name=this.opt.scoreName,t.type="hidden",this.self.appendChild(t),t}},{key:"_createCancel",value:function(){var t,e=this.opt.path+this.opt.cancelOff,i=document.createElement(this.opt.starType),s={title:this.opt.cancelHint,class:this.opt.cancelClass};for(t in"img"===this.opt.starType?(document.width="20px",document.height="20px",s.src=e,s.alt="x"):(i.style.fontSize="100%",s["data-alt"]="x",s.class=e),s)i.setAttribute(t,s[t]);"left"===this.opt.cancelPlace?(this.self.prepend(" "),this.self.prepend(i)):(this.self.append(" "),this.self.appendChild(i)),i.id="raty-cancel-btn",this.cancelButton=document.querySelector("#raty-cancel-btn")}},{key:"_createScore",value:function(){var t=document.querySelector(this.opt.targetScore);this.scoreField=null!=t?t:this._buildScoreField()}},{key:"_createStars",value:function(){for(var t=1;t<=this.opt.number;t++){var e,i=this._attributesForIndex(t),s=new Image(20,20),o=document.createElement(this.opt.starType),n=(o.style.fontSize="100%","img"===this.opt.starType?s:o);for(e in n.id="raty-rate-"+t,i)n.setAttribute(e,i[e]);this.self.appendChild(n),this.opt.space&&t<this.opt.number&&this.self.append(" ")}var a=document.querySelectorAll("".concat(this.element," > ").concat(this.opt.starType,'[id^="raty-rate"]'));this.cancelButton&&a.filter(function(t){return"#raty-cancel-btn"!==t.id}),this.stars=a}},{key:"_error",value:function(t){throw new Error(t)}},{key:"_executeCallbacks",value:function(){for(var t,e=["number","readOnly","score","scoreName","target","path"],i=0;i<e.length;i++)"function"==typeof this.opt[e[i]]&&((t=this.opt[e[i]].call(this.element))?this.opt[e[i]]=t:delete this.opt[e[i]])}},{key:"_fill",value:function(t){var e=0;if(this.opt.iconRangeSame&&this.opt.iconRange)for(;e<this.opt.iconRange.length&&this.opt.iconRange[e].range<t;)e++;for(var i=1;i<=this.stars.length;i++){var s,o,n=this.stars[i-1],a=this._turnOn(i,t);this.opt.iconRange&&this.opt.iconRange.length>e?(s=this.opt.iconRange[e],o=this._getRangeIcon(s,a),i<=s.range&&this._setIcon(n,o),i===s.range&&e++):(o=this.opt[a?"starOn":"starOff"],this._setIcon(n,o))}}},{key:"_getDecimal",value:function(t,e){var t=t.toString().split(".")[1],i=0;return t&&(i=parseInt(t.slice(0,e),10),"9999"===t.slice(1,5)&&i++),i}},{key:"_getRangeIcon",value:function(t,e){return e?t.on||this.opt.starOn:t.off||this.opt.starOff}},{key:"_getScoreByPosition",value:function(t,e){var i,s=parseInt(e.alt||e.getAttribute("data-alt"),10);return this.opt.half&&(i=this._getWidth(),s=s-1+parseFloat((t.pageX-e.offsetLeft)/i)),s}},{key:"_getHint",value:function(t,e){var i,s,o;return 0===t||t?(i=this._getDecimal(t,1),s=Math.ceil(t),o=s=this.opt.hints[(s||1)-1],e=!e||this.isMove,this.opt.precision?o=s[i=e?0===i?9:i-1:i]:(this.opt.halfShow||this.opt.half)&&(o=s[i=e&&0===i||5<i?1:0]),""===o?"":o||t):this.opt.noRatedMsg}},{key:"_getWidth",value:function(){var t=this.stars[0].width||parseFloat(this.stars[0].style.fontSize);return t||this._error("Could not get the icon width!"),t}},{key:"_lock",value:function(){var t,e=this._getHint(null==this||null==(t=this.scoreField)?void 0:t.value);this.self.style.pointerEvents="none",this.self.title=e,this.scoreField.readOnly=!0,this.stars.forEach(function(t){t.title=e}),this.cancelButton&&(this.cancelButton.style.display="none"),this.opt.readOnly=!0}},{key:"_nameForIndex",value:function(t){return this.opt.score&&this.opt.score>=t?"starOn":"starOff"}},{key:"_resetTitle",value:function(){for(var t=0;t<this.opt.number;t++)this.stars[t].title=this._getHint(t+1)}},{key:"_roundHalfScore",value:function(t){var e=parseInt(t,10),t=this._getDecimal(t,1);return e+(t=0!==t?5<t?1:.5:t)}},{key:"_roundStars",value:function(t,e){var e=this._starName(t,e);e&&(e=this.opt[e],t=this.stars[Math.ceil(t)-1],this._setIcon(t,e))}},{key:"_setIcon",value:function(t,e){t["img"===this.opt.starType?"src":"className"]=this.opt.path+e}},{key:"_setPath",value:function(){this.opt.path=this.opt.path||"",this.opt.path&&"/"!==this.opt.path.slice(-1)[0]&&(this.opt.path+="/")}},{key:"_setTarget",value:function(t,e){e=e&&this.opt.targetFormat.toString().replace("{score}",e),t instanceof HTMLInputElement||t instanceof HTMLSelectElement?t.value=e:t.textContent=e}},{key:"_setTitle",value:function(t,e){var i;t&&(i=parseInt(Math.ceil(t),10),this.stars[i-1].title=this._getHint(t,e))}},{key:"_starName",value:function(t,e){t=+(t%1).toFixed(2);return e||this.isMove?.5<t?"starOn":"starHalf":t<=this.opt.round.down?void 0:this.opt.halfShow&&t<this.opt.round.up?"starHalf":t<this.opt.round.full?"starOff":"starOn"}},{key:"_target",value:function(t,e){var i,s;this.opt.target&&((i=document.querySelector(this.opt.target))||this._error("Target selector invalid or missing!"),s=e&&"mouseover"===e.type,void 0===t?t=this.opt.targetText:null===t?t=s?this.opt.cancelHint:this.opt.targetText:("hint"===this.opt.targetType?t=this._getHint(t,e):this.opt.precision&&(t=parseFloat(t).toFixed(1)),e=e&&"mousemove"===e.type,s||e||this.opt.targetKeep||(t=this.opt.targetText)),this._setTarget(i,t))}},{key:"_turnOn",value:function(t,e){return this.opt.single?t===e:t<=e}},{key:"_unlock",value:function(){this.self.style.pointerEvents="auto",this.self.removeAttribute("title"),this.scoreField.readOnly=!1,this._resetTitle(),this.opt.readOnly=!1,this.cancelButton&&(this.cancelButton.style.display="")}}]),i}(),_default=Raty;exports.default=_default;